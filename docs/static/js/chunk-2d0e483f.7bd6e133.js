(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e483f"],{"910a":function(s,a,r){"use strict";r.r(a);var t=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},e=[function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("section",[r("p",[s._v("最近看完了阮一峰老师的*"),r("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2010/05/object-oriented_javascript_encapsulation.html"}},[s._v("面向对象编程系列")]),s._v("*，就一时手痒想写个小demo来练练手，熟悉下面向对象的思想。选来选去，还是想找个逻辑稍微简单点的游戏来做例子，然后有一天突然想到大学时未写完的打砖块，ok！就它了！")]),r("blockquote",[r("p",[s._v("结果发现是个深坑。。/(ㄒoㄒ)/~~")])]),r("p",[s._v("好了，废话不多说，正文开始。")]),r("blockquote",[r("p",[s._v("PS：因为这个程序第一遍是用面向过程的老办法写的，所以先从面向过程入手，大致理一遍游戏的逻辑，再讲解用面向对象重构程序的思路。")])]),r("h1",[s._v("pop-程序初始化")]),r("h2",[s._v("程序入口")]),r("p",[s._v("（事先声明，由于本篇文章重点在于面向对象的思路讲解，所以程序本身的逻辑部分就尽量简单的叙述了，有不清楚的可以直接去看源码。）"),r("br"),s._v(" 面向过程程序的初始化通场分为几个部分：入口函数、全局变量声明、初始化方法调用。这里首先要讲的就是整个程序的入口函数，在Web开发中一般可以用以下几种方式让网页在加载完所有资源后调用js文件或者执行js函数：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 1、onload方法")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".onload = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化函数")]),s._v("\n};\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 2、jQuery")]),s._v("\n$("),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(").ready("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化函数")]),s._v("\n});\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//可以简写为以下形式")]),s._v("\n$("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化函数")]),s._v("\n});\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 3、自执行函数（挖个坑，重构部分会讲到")]),s._v("\n")])]),r("p",[s._v("那么问题来了，这几种方法有区别么？或者说互相能代替么？"),r("br"),s._v(" 答案是不行，具体见："),r("em",[r("a",{attrs:{href:"https://segmentfault.com/q/1010000000524008"}},[s._v("js自执行函数可否代替onload事件？")])])]),r("h2",[s._v("全局变量声明")]),r("p",[s._v("由于面向过程是函数调用函数，所以变量只分为各个函数内的局部变量和函数外的全局变量，本程序的全局变量如下：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" canvas; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 画布元素")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" context; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// context对象")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" canvasWidth = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("640")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 定义画布宽度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" canvasHeight = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("480")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 定义画布高度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" gameStart = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏是否开始")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" gameTimer; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏定时器，主循环")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" gameScore = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏得分")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" gameLife = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏生命条数")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 小球属性 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballRadius = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球半径")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballSpeed = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球速度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballColor = "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"#eee"')]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球颜色")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballSpeedX = ballSpeed; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球X方向的速度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballSpeedY = ballSpeed; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球Y方向的速度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballPositionX = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("320")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球位置X坐标")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ballPositionY = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("420")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球位置Y坐标")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 球板属性 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" boardWidth = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("80")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板宽度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" boardHeigth = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板高度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" boardSpeed = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板速度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" boardPositionX = canvasWidth/"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(" - boardWidth/"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板位置X坐标")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" boardPositionY = canvasHeight - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(" - boardHeigth; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板位置Y坐标")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" boardColor = "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"#000"')]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板颜色")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 砖块属性 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" brickWidth = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 砖块宽度")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" brickHeight = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20")]),s._v("; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 砖块高度")]),s._v("\n")])]),r("p",[s._v("为什么有这么多？因为这些变量不写在程序最顶部，程序调用的函数将无法调用或改变其他函数使用的变量。其实这里的缺点已经显而易见了：变量过多难以维护、容易引起作用域混乱、容易与函数内部变量冲突等等，从各个角度讲这都是最low的一种实现方式，在重构部分中我们会有更好的变量组织方式。")]),r("h2",[s._v("初始化方法调用")]),r("p",[s._v("本程序的初始化大体分为几个步骤：绘制游戏界面、初始化游戏生命及分数、绑定事件，见代码：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 页面加载完成后执行此方法 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 本程序的入口函数 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".onload = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获得canvas元素")]),s._v("\n    canvas = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"canvas"')]),s._v(");\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获得context对象")]),s._v("\n    context = canvas.getContext("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"2d"')]),s._v(");\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置canvas尺寸")]),s._v("\n    canvas.setAttribute("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"width"')]),s._v(", canvasWidth);\n    canvas.setAttribute("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"height"')]),s._v(", canvasHeight);\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化游戏")]),s._v("\n    initGame();\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化游戏分数")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"score"')]),s._v(").innerHTML = gameScore;\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化游戏生命")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"life"')]),s._v(").innerHTML = gameLife;\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绑定canvas点击事件")]),s._v("\n    canvas.onclick = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (gameStart) {\n            gameStart = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// gameTimer = setInterval(function(){")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//        gameLoop(context);")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//    }, 10);")]),s._v("\n\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏主循环")]),s._v("\n            gameLoop();\n        }\n    };\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 监听键盘事件")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".addEventListener("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"keydown"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("event")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" e = event || "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".event;\n\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 按下向左键")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (e.keyCode === "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("37")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (gameStart) {\n                moveStopBall(-boardSpeed);\n            }\n            moveBoard(-boardSpeed);\n        }\n\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 按下向右键")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (e.keyCode === "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("39")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (gameStart) {\n                moveStopBall(boardSpeed);\n            }\n            moveBoard(boardSpeed);\n        }\n    }, "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(");\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 监听鼠标移动事件")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".addEventListener("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"mousemove"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" relativeX = e.clientX - canvas.getBoundingClientRect().left;\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(relativeX > boardWidth / "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(" && relativeX < canvas.width - boardWidth / "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (gameStart) {\n                context.clearRect("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", canvasWidth, canvasHeight);\n                initBricks();\n                ballPositionX = relativeX;\n                drawBall(ballPositionX, ballPositionY);\n            }\n            boardPositionX = relativeX - boardWidth / "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(";\n            drawBoard(boardPositionX, boardPositionY);\n        }\n    }, "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(");\n};\n")])]),r("p",[s._v("其中在"),r("code",{pre:!0},[s._v("initGame()")]),s._v("里分别调用了三个函数来绘制砖块、球板和球的初始位置，绘制代码里值得一提的是砖块的绘制：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 初始化砖块位置 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("initBricks")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; i < bricks.length; i++) {\n        drawBrick(bricks[i].brickPositionX, bricks[i].brickPositionY, bricks[i].brickColor);\n    }\n}\n")])]),r("p",[s._v("因为每个砖块都有位置、颜色等基本属性，所以这里将其定义为单独的一个数组，数组里存放砖块对象，格式如下（详情见源码"),r("code",{pre:!0},[s._v("brickConfig.js")]),s._v("文件）：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 砖块参数配置 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" bricks = [\n    {\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("brickPositionX")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("brickPositionY")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("brickColor")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"#ff0000"')]),s._v("\n    }\n]\n")])]),r("p",[s._v("游戏初始化结束后，接下来就是事件的绑定了，为了便于控制，在常规键盘的操作上还增加了鼠标移动，鼠标控制的原理稍显复杂，需要计算鼠标和画布左边的相对距离，不过绘制逻辑是一样的。")]),r("h1",[s._v("pop-程序主体逻辑")]),r("h2",[s._v("游戏主循环")]),r("p",[s._v("一般涉及到画面有动态图形绘制的游戏都会有一个“主循环”函数，而这也是游戏程序的基本思路之一。在我们的程序中，当用户点击界面后，游戏便会正式开始，这时候我们会去执行"),r("code",{pre:!0},[s._v("gameLoop()")]),s._v("函数，这个函数的主要逻辑就是让小球移动，然后在画面刷新的每一帧里去检测小球的碰撞。怎么才能让小球移动呢？这里涉及到的又一个游戏编程里的重要概念就是画面刷新以及帧数的控制，小球并不是真的自己在动，而是我们在程序中去给它改变画布上的x、y坐标以及定时去让画面刷新的结果。")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 游戏主循环 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("gameLoop")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    gameTimer = requestAnimationFrame(gameLoop);\n    moveBall();\n    checkBallPosition();\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; i < bricks.length; i++) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (checkBallCollide(bricks[i].brickPositionX, bricks[i].brickPositionY, brickWidth, brickHeight)) {\n            bricks.splice(i, "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(");\n            gameScore = gameScore + "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("100")]),s._v(";\n            "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"score"')]),s._v(").innerHTML = gameScore;\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (bricks.length == "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n                cancelAnimationFrame(gameTimer);\n                alert("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"你赢了！你的得分是"')]),s._v("+gameScore+"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"分！"')]),s._v(");\n                "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".location.reload();\n            }\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("break")]),s._v(";\n        }\n    }\n    checkBallCollide(boardPositionX, boardPositionY, boardWidth, boardHeigth);\n}\n")])]),r("blockquote",[r("p",[s._v("PS：在HTML5的新特性中，给我们提供了"),r("code",{pre:!0},[s._v("requestAnimationFrame()")]),s._v("这样一个函数，它能自动优化画面的刷新，所以我们这里就可以抛弃掉原生的setInterval方法了。")])]),r("h2",[s._v("碰撞检测")]),r("p",[s._v("好了，终于到了这个程序逻辑最核心的部分。")]),r("p",[s._v("碰撞检测，一个可大可小的概念，但是在游戏里的地位却是举足轻重的，因为好的碰撞检测往往能大幅度的提升玩家的游戏体验，而在我们的程序中便是要判断砖块和小球的碰撞。让我们把这个概念稍微抽象一下，其实就是要去判断屏幕上一个矩形与圆形是否重叠。")]),r("p",[s._v("怎么样？乍看之下觉得简单？当你真正往下思考的时候便会发现这个问题并不简单，甚至当我们在程序中真正使用的时候更会遇到各种各样的问题。我采用的实现是Milo Yip大大在知乎上贴出来的算法实现："),r("em",[r("a",{attrs:{href:"https://www.zhihu.com/question/24251545"}},[s._v("怎样判断平面上一个矩形和一个圆形是否有重叠？")])])]),r("p",[s._v("这个算法利用了向量来进行位置的判断与运算，大大简化了坐标的运算量。这里说一下，我的程序采用的这种原始坐标的计算方法其实是很low的，比较好的做法是用向量来表示对象的位置和运动，因为我也还在学习研究中，所以并没有给出自己的实现，这里贴出一些关于向量的基础资料：")]),r("p",[r("em",[r("a",{attrs:{href:"https://www.bbsmax.com/A/gAJGPPwo5Z/"}},[s._v("javascript中的“向量”")])])]),r("p",[r("em",[r("a",{attrs:{href:"http://www.cnblogs.com/xqhppt/archive/2012/03/31/2427611.html"}},[s._v("Javascript 向量简单应用")])])]),r("p",[r("em",[r("a",{attrs:{href:"http://wuzhiwei.net/vector_circle_line_collide/"}},[s._v("利用向量运算解决圆线碰撞问题")])])]),r("p",[s._v("再补充一个关于向量的库："),r("em",[r("a",{attrs:{href:"https://github.com/subprotocol/verlet-js"}},[s._v("verlet-js")])]),s._v("，基本实现了常用的向量运算。")]),r("p",[s._v("在程序中实现了这个算法后，发现游戏确实能正常判断碰撞了，但是在某些特定情况之下会出现小球进入砖块内部来回碰撞的情况，这是为什么呢？其实这个bug在游戏碰撞中也很常见，但是刚开始我也不知道真正的原因，所以关于这个问题我在segmentfault和zhihu都提了问题：")]),r("p",[r("em",[r("a",{attrs:{href:"https://www.zhihu.com/question/63683267"}},[s._v("打砖块游戏中 怎么判断小球与方块的撞击 以及小球撞击后运动的方向呢？")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://segmentfault.com/q/1010000010567456"}},[s._v("打砖块游戏中 怎么判断小球与方块撞击后运动的方向呢？")])])]),r("p",[s._v("一句话概括的话，原因主要就是小球在n-1帧处于砖块的外面，然后第n帧进行判断的时候已经在砖块内部了，所以第n+1帧小球再进行碰撞判断就会让它反复在砖块内运动了，我们的碰撞检测的基础是小球不能处于砖块内部，而现在的问题基本就暴露出来了，必须让小球在第n帧的时候一定处于砖块外面或者刚好与砖块相切的位置，所以我们就应该手动去让小球与砖块“分离”，但是这个分离的最小距离和方向应该怎么计算呢？关于这个问题，在我们现在的算法里实际上是很难精确计算出来的，所以我只做了一个简单的坐标纠正，虽然在小部分连续碰撞的情况下还会出问题，但是在大多数时候都比原来好多了。")]),r("p",[s._v("我知道这个时候你想问的问题，有没有一种算法能完美的计算出这个最小分离量呢？答案是肯定的，这个算法就是在碰撞检测中很有名的"),r("code",{pre:!0},[s._v("分离轴定理（Separating Axis Theorem）")]),s._v("。运用这个定理能一次性解决2d平面内所有凸边形的碰撞检测，可以说是非常高级的方法了，不过实现过程这里不是重点就带过了，给出一些关于碰撞的资料供参考：")]),r("p",[r("em",[r("a",{attrs:{href:"http://blog.csdn.net/yorhomwang/article/details/54869018"}},[s._v("碰撞检测之分离轴定理算法讲解")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-TW/docs/Games/Techniques/2D_collision_detection"}},[s._v("AABB碰撞盒算法")])])]),r("p",[r("em",[r("a",{attrs:{href:"http://blog.mn886.net/chenjianhua/show/dc896035baa6/index.html"}},[s._v("javascript的2D空间碰撞检测")])])]),r("p",[r("em",[r("a",{attrs:{href:"http://www.umiringo.com/2017/06/02/2dpeng-zhuang-jian-ce-zhi-fen-chi-zhou-suan-fa-separating-axis-theorem/"}},[s._v("2D碰撞检测之分离轴算法（Separating Axis Theorem）")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://github.com/JChehe/blog/issues/8"}},[s._v("“等一下，我碰！”——常见的2D碰撞检测")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/23903445"}},[s._v("扇形与圆盘相交测试浅析")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://xxyj.github.io/2017/06/07/%E5%9F%BA%E4%BA%8Ecanvas%E7%9A%84%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B/"}},[s._v("基于canvas的碰撞检测")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://stackoverflow.com/questions/21089959/detecting-collision-of-rectangle-with-circle"}},[s._v("Detecting collision of rectangle with circle")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://stackoverflow.com/questions/401847/circle-rectangle-collision-detection-intersection?noredirect=1&lq=1"}},[s._v("Circle-Rectangle collision detection (intersection)")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://stackoverflow.com/questions/18704999/how-to-fix-circle-and-rectangle-overlap-in-collision-response?rq=1"}},[s._v("How to fix circle and rectangle overlap in collision response?")])])]),r("p",[r("em",[r("a",{attrs:{href:"https://stackoverflow.com/questions/45370692/circle-rectangle-collision-response"}},[s._v("Circle/rectangle collision response")])])]),r("p",[s._v("在搜集资料的过程中，发现两个关于canvas方面的不错的博客，它们也给了我不少启发：")]),r("p",[r("em",[r("a",{attrs:{href:"http://www.cnblogs.com/hongru/"}},[s._v("岑安")])])]),r("p",[r("em",[r("a",{attrs:{href:"http://www.cnblogs.com/iamzhanglei/"}},[s._v("当耐特")])])]),r("p",[s._v("面向过程的程序梳理就到这里，那么接下来我们就可以用面向对象的思路开始重构了。")]),r("h1",[s._v("oop-程序初始化")]),r("h2",[s._v("自执行函数")]),r("p",[s._v("首先还是程序的初始化，我们这里就不采用传统的window.onload了，而是用“自执行函数”的方式，关于这个概念可以参考如下问题："),r("br"),r("em",[r("a",{attrs:{href:"https://segmentfault.com/q/1010000000718015"}},[s._v("javascript 这样写(function(){})() 有什么用途？")])]),r("br"),s._v(" 简单来说，只要这样写了，浏览器就会自动执行这个js文件的内容，非常方便快捷。")]),r("h1",[s._v("oop-基本对象的抽象")]),r("h2",[s._v("对象梳理")]),r("p",[s._v("面向对象程序编写的第一步往往是程序对象的梳理，因为只有梳理出基本的对象，程序才能对象化，而不是流程化。"),r("br"),s._v(" 在我们的程序中，最基本的对象无非就是小球、球板、砖块，它们之间相互影响的关系便构成了游戏的核心。")]),r("h2",[s._v("小球")]),r("p",[s._v("首先是小球自身的属性定义：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 定义小球 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Ball = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x, y")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballPositionX = x; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球球心X坐标")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballPositionY = y; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球球心Y坐标")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballSpeedX = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballSpeed; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球X方向的速度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballSpeedY = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballSpeed; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球Y方向的速度")]),s._v("\n};\n")])]),r("p",[s._v("这四个属性因为会随着程序的逻辑状态而发生改变，所以我们将它们定义在构造函数中，方便调用，剩下的一些属性和方法就可以定义在Ball对象的原型上了：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("Ball.prototype = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("ballRadius")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球半径")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("ballSpeed")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球速度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("ballColor")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"#eee"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 小球颜色")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绘制小球")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("drawBall")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x, y, context")]),s._v(") ")]),s._v("{\n        context.beginPath();\n        context.arc(x, y, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballRadius, "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Math")]),s._v(".PI * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(");\n        context.fillStyle = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballColor;\n        context.fill();\n        context.closePath();\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变小球球心X坐标")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("moveBallPositionX")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("speed")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballPositionX = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballPositionX + speed;\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变小球球心Y坐标")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("moveBallPositionY")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("speed")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballPositionY = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".ballPositionY + speed;\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 检测小球是否与球板或者砖块碰撞（算法暂时存在bug，待优化）")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("checkBallCollide")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x, y, width, height")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//  略")]),s._v("\n    }\n}\n")])]),r("h2",[s._v("球板")]),r("p",[s._v("球板的定义只需要左上角的绘制坐标即可：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 定义球板 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Board = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x, y")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX = x; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板位置X坐标")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionY = y; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板位置Y坐标")]),s._v("\n};\n")])]),r("p",[s._v("自身属性以及绘制方法的定义：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("Board.prototype = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("boardWidth")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("80")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板宽度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("boardHeigth")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板高度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("boardSpeed")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板速度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("boardColor")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"#000"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 球板颜色")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绘制球板")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("drawBoard")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x, y")]),s._v(") ")]),s._v("{\n        context.beginPath();\n        context.fillStyle = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardColor;\n        context.fillRect(x, y, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardWidth, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardHeigth);\n        context.closePath();\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 检测球板位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("checkBoardPosition")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("speed")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX + speed < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".drawBoard("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionY);\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("-1")]),s._v(";\n        } \n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX + speed > canvasWidth - "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardWidth) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX = canvasWidth - "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardWidth;\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".drawBoard("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionY);\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";\n        }\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 移动球板")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("moveBoard")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("speed")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".checkBoardPosition(speed) == "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX + speed;\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".drawBoard("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionX, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".boardPositionY);\n        }\n    }\n};\n")])]),r("p",[s._v("在"),r("code",{pre:!0},[s._v("checkBoardPosition()")]),s._v("中我们会对球板的位置进行判断，如果到达画布边缘就不再让它的坐标变化了，和小球的处理逻辑类似。")]),r("h2",[s._v("砖块")]),r("p",[s._v("砖块的定义：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Brick = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x, y, level")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".brickPositionX = x;\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".brickPositionY = y;\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".brickLevel = level;\n};\nBrick.prototype = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("brickWidth")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 砖块宽度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("brickHeight")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 砖块高度")]),s._v("\n};\n")])]),r("p",[s._v("砖块本身的定义比较简单，没什么好说的。")]),r("h2",[s._v("砖块集合")]),r("p",[s._v("因为我们需要批量去处理所有砖块，所以这里就定义一个砖块集合的对象，统一来配置砖块的属性：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Bricks = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{};\n\nBricks.prototype = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("brickColors")]),s._v(": [],\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绘制砖块")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("drawBrick")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("game")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" config = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".bricksConfig[game.gameLevel - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("];\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; i < config.length; i++) {\n            context.beginPath();\n            context.fillStyle = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".brickColors[i];\n            context.fillRect(config[i].brickPositionX, config[i].brickPositionY, config[i].brickWidth, config[i].brickHeight);\n            context.closePath();\n        }\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化方块颜色")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("initBrickColors")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" config = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".bricksConfig[game.gameLevel - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("];\n\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; i < config.length; i++) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".brickColors.push("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'rgb('")]),s._v("+"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getRandNum("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("255")]),s._v(")+"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("','")]),s._v("+"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getRandNum("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("255")]),s._v(")+"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("','")]),s._v("+"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getRandNum("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("255")]),s._v(")+"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("')'")]),s._v(");\n        }\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 生成随机数")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("getRandNum")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("num")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Math")]),s._v(".floor("),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Math")]),s._v(".random() * num + "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(");\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 砖块配置信息")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("bricksConfig")]),s._v(": [\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 第一关")]),s._v("\n        [\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 左上到右下")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(",   "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("40")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("80")]),s._v(",   "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("60")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("120")]),s._v(",  "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("80")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("160")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("100")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("200")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("120")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("240")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("140")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("280")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("160")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("320")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("180")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("360")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("200")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("400")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("220")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("440")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("240")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("480")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("260")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("520")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("280")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" Brick("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("560")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("300")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("), \n        ],\n        ...\n    ]\n}    \n")])]),r("p",[s._v("在"),r("code",{pre:!0},[s._v("bricksConfig")]),s._v("里我们会将每一关的砖块配置单独定义为一个数组，而砖块就统一用new关键字来创建。（这里因为砖块的坐标没有规律，不然采用循环来创建是最好的）"),r("br"),s._v(" 颜色的初始化是利用的rgb的色值，每次生成的时候就去取255内的随机数，达到颜色的随机效果。")]),r("p",[s._v("到这里就结束了吗？显然还不够，我们还需要一个游戏状态的对象，来管理游戏的基本属性。")]),r("h2",[s._v("游戏状态")]),r("p",[s._v("在这个程序中，我们需要四个基本的游戏属性状态：游戏开始和结束状态、游戏得分、游戏生命条数、游戏关卡数，而分数的设置就直接将程序中的变量显示到界面即可。")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/* 定义游戏状态 */")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Game = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("gameStart, gameScore, gameLife, gameLevel")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".gameStart = gameStart; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏是否开始")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".gameScore = gameScore; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏得分")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".gameLife = gameLife; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏生命条数")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".gameLevel = gameLevel; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 游戏关卡数")]),s._v("\n};\n\nGame.prototype = {\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置游戏分数")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("setGameScore")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("gameScore")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"score"')]),s._v(").innerHTML = gameScore;\n    },\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置游戏生命")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("setGameLife")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("gameLife")]),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".getElementById("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"life"')]),s._v(").innerHTML = gameLife;\n    }\n};\n")])]),r("p",[s._v("本篇文章基本讲解完毕，靠一篇文章当然是讲不清楚oop和pop的，我们也不能简单的说oop就比pop好，但是通过本篇文章可以看到在大多数时候oop确实能使我们的程序更清晰易懂，即使代码结构稍微复杂点我觉得也是值得的。"),r("br"),r("em",[r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/28427324?group_id=878914871377424384"}},[s._v("面向过程 VS 面向对象")])]),s._v("：在这篇文章里用五子棋程序为例也简单的比较了两种方法的优劣，希望能给大家一些启发吧~")]),r("p",[s._v("最后别忘了给我的项目点个Star哦~(〃'▽'〃) "),r("em",[r("a",{attrs:{href:"https://github.com/csd758371536/Brick"}},[s._v("Brick")])])])])}],n=r("2877"),l={},p=Object(n["a"])(l,t,e,!1,null,null,null);a["default"]=p.exports}}]);