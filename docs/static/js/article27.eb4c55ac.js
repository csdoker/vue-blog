(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["article27"],{2676:function(s,a,r){"use strict";r.r(a);var t=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},e=[function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("section",[r("p",[s._v("通过"),r("a",{attrs:{href:"https://rekodsc.com/detail/10"}},[s._v("上一篇")]),s._v("文章的学习，我们基本掌握了一个轮子的封装和开发流程。那么这次将带大家开发一个更有难度的项目——轮播图，希望能进一步加深大家对于面向对象插件开发的理解和认识。")]),r("p",[s._v("So, Let's begin!")]),r("blockquote",[r("p",[s._v("目前项目使用 ES5及UMD 规范封装，所以在前端暂时只支持"),r("code",{pre:!0},[s._v("<script>")]),s._v("标签的引入方式，未来会逐步用 ES6 进行重构")])]),r("blockquote",[r("p",[s._v("演示地址："),r("em",[r("a",{attrs:{href:"https://csdoker.github.io/csdemos/carousel/pc/"}},[s._v("carousel")])]),s._v(" "),r("em",[r("a",{attrs:{href:"https://csdoker.github.io/csdemos/carousel/mobile/"}},[s._v("carousel-mobile")])]),r("br"),s._v(" Github："),r("em",[r("a",{attrs:{href:"https://github.com/csdoker/csdwheels"}},[s._v("csdwheels")])]),r("br"),r("em",[s._v("如果觉得好用就点个Star吧~(〃'▽'〃)")])])]),r("p",[r("img",{attrs:{src:"https://i.loli.net/2018/08/10/5b6d05ea7e673.gif",alt:"carousel"}}),r("br"),r("img",{attrs:{src:"https://i.loli.net/2018/08/10/5b6d05e381d6b.gif",alt:"carousel-mobile"}})]),r("h1",[s._v("Web轮播")]),r("h2",[s._v("思路分析")]),r("p",[s._v("老规矩，在写代码之前，我们需要对要开发的东西有个感性的认识，比如你可以先在脑中大致过一遍最终的项目效果是如何的，而在这里你可以直接看上面的动态图or项目页面进行体验。实际的开发阶段之前，我们更要对插件的逻辑思路有一个整体的分析，这样在开发时才会更有效率，并且可以有效避免因为思路不清晰而导致的问题。")]),r("p",[s._v("首先来看看Web轮播的效果及交互有哪些：")]),r("ol",[r("li",[s._v("每隔一段时间自动轮播")]),r("li",[s._v("左右箭头可切换轮播")]),r("li",[s._v("圆点可切换轮播")]),r("li",[s._v("当鼠标在轮播区域内时，轮播暂停；离开区域后，轮播重新开始")]),r("li",[s._v("轮播切换时，会有一个匀速运动的动画效果")]),r("li",[s._v("当向右切换到最后一张时，会自动循环到第一张；向左切换到第一张时，循环到最后一张")])]),r("p",[s._v("如上几点，可以说都是一个轮播图必须实现的经典效果了。其他效果先忽略，第六点对于新手来说明显是最有难度的，事实上这个效果有个常见的名字——无缝轮播。“无缝”也可以理解为无限循环，其实就是可以让轮播朝着一个方向一直切换，并且自动在切换到头尾图片时循环。")]),r("p",[s._v("比如现在有五张图片，我们把它们编号为：")]),r("blockquote",[r("p",[s._v("1 2 3 4 5")])]),r("p",[s._v("要实现上面的效果，你可能会想到在切换至头尾时加个判断，强制改变图片位置，但是如果这么做的话，当你最后一张图切换回第一张图时就会出现空白，因此还需要在头尾分别添加一个尾部和头部的元素作为位置改变时的过渡：")]),r("blockquote",[r("p",[s._v("5 1 2 3 4 5 1")])]),r("p",[s._v("有了这两张辅助图，上面的效果就能顺利实现了。到此，项目的基础思路分析完毕，让我们进入编码阶段吧！")]),r("h2",[s._v("基本架构")]),r("p",[s._v("正式开始之前，还是需要先把项目的基本架构搭建起来：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("root, factory")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v(" define === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"function"')]),s._v(" && define.amd) {\n      define([], factory);\n    } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("module")]),s._v(" === "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"object"')]),s._v(" && "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("module")]),s._v(".exports) {\n      "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("module")]),s._v(".exports = factory();\n    } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n      root.Carousel = factory();\n    }\n  })("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v(" self !== "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"undefined"')]),s._v(" ? self : "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"use strict"')]),s._v(";\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// ID-NAMES")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" ID = {\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_WRAP")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'#carouselWrap'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_DOTS")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'#carouselDots'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("ARROW_LEFT")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'#arrowLeft'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("ARROW_RIGHT")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'#arrowRight'")]),s._v("\n    };\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" CLASS = {\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_WRAP")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-wrap'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_IMG")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-image'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_DOTS_WRAP")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-buttons-wrap'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_DOTS")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-buttons'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_DOT")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-button'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_DOT_ON")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-button on'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_ARROW_LEFT")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-arrow arrow-left'")]),s._v(",\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("CAROUSEL_ARROW_RIGHT")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'carousel-arrow arrow-right'")]),s._v("\n    };\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// Polyfills")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("addEvent")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("element, type, handler")]),s._v(") ")]),s._v("{\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (element.addEventListener) {\n        element.addEventListener(type, handler, "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(");\n      } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (element.attachEvent) {\n        element.attachEvent("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"on"')]),s._v(" + type, handler);\n      } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n        element["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"on"')]),s._v(" + type] = handler;\n      }\n    }\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 合并对象")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("extend")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("o, n, override")]),s._v(") ")]),s._v("{\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" p "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" n) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (n.hasOwnProperty(p) && (!o.hasOwnProperty(p) || override))\n          o[p] = n[p];\n      }\n    }\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 轮播-构造函数")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" Carousel = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("selector, userOptions")]),s._v(") ")]),s._v("{\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n      "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 合并配置")]),s._v("\n      extend("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions, userOptions, "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(");\n      "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取轮播元素")]),s._v("\n      _this.carousel = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".querySelector(selector);\n      "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化轮播列表")]),s._v("\n      _this.carousel.appendChild(_this.getImgs());\n      "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取轮播列表")]),s._v("\n      _this.carouselWrap = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".querySelector(ID.CAROUSEL_WRAP);\n      "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 每隔 50ms 检测一次轮播是否加载完成")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" checkInterval = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("50")]),s._v(";\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" checkTimer = setInterval("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 检测轮播是否加载完成")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (_this.isCarouselComplete()) {\n          "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 加载完成后清除定时器")]),s._v("\n          clearInterval(checkTimer);\n          "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化轮播")]),s._v("\n          _this.initCarousel();\n          "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化圆点")]),s._v("\n          _this.initDots();\n          "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初识化箭头")]),s._v("\n          _this.initArrows();\n        }\n      }, checkInterval);\n    };\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 轮播-原型对象")]),s._v("\n    Carousel.prototype = {\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("carouselOptions")]),s._v(": {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 是否显示轮播箭头")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("showCarouselArrow")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 是否显示轮播圆点")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("showCarouselDot")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 轮播自动播放间隔")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("carouselInterval")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3000")]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 轮播动画总时间")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("carouselAnimateTime")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("150")]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 轮播动画间隔")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("carouselAnimateInterval")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v("\n      },\n      "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("isCarouselComplete")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 检测页面图片是否加载完成")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" completeCount = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; i < "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children.length; i++) {\n          "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children[i].complete) {\n            completeCount++;\n          }\n        }\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" completeCount === "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children.length ? "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(" : "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n      }\n    };\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" Carousel;\n});\n")])]),r("p",[r("code",{pre:!0},[s._v("addEvent()")]),s._v("和"),r("code",{pre:!0},[s._v("extend()")]),s._v("函数上篇已经介绍过了，构造函数中各种配置项也都是项目中要用到的，不必多说。这里的重点是"),r("code",{pre:!0},[s._v("checkTimer")]),s._v("定时器，它的作用是每隔一定时间去检查页面上的图片元素是否全部加载完毕，如果加载完毕再进行项目的初始化。"),r("br"),s._v(" 为什么需要这么做呢？因为我们的图片元素是在JS中使用DOM动态加载的，所以可能会出现图片还没加载完成就执行了JS中的一些逻辑语句，导致不能通过DOM API正确获取到图片和对应元素属性的现象。因此，在"),r("code",{pre:!0},[s._v("isCarouselComplete()")]),s._v("函数中我们利用"),r("code",{pre:!0},[s._v("img")]),s._v("元素的"),r("code",{pre:!0},[s._v("complete")]),s._v("属性，判断当前页面上的所有图片是否加载完成，然后就能保证DOM属性的正确获取了。")]),r("h2",[s._v("初始化轮播")]),r("p",[s._v("完成"),r("code",{pre:!0},[s._v("initCarousel()")]),s._v("函数：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("initCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("selector, userOptions")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取轮播数量")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children.length;\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setCarousel();\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化轮播序号")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化定时器")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIntervalr = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 每次位移量 = 总偏移量 / 次数")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselAnimateSpeed = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth / ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.carouselAnimateTime / "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.carouselAnimateInterval);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 判断是否处于轮播动画状态")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 判断圆点是否点击")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isDotClick = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 绑定轮播图事件")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".bindCarousel();\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 播放轮播")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".playCarousel();\n}\n")])]),r("p",[s._v("通过"),r("code",{pre:!0},[s._v("this.carouselWidth / (this.carouselOptions.carouselAnimateTime / this.carouselOptions.carouselAnimateInterval)")]),s._v("这个公式，可以计算出每次轮播动画位移的偏移量，后面完成动画函数时会用到。")]),r("p",[s._v("在"),r("code",{pre:!0},[s._v("setCarousel()")]),s._v("里进行轮播基本属性的设置：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("setCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 复制首尾节点")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" first = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("].cloneNode("),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(");\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" last = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children["),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("].cloneNode("),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(");\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 添加过渡元素")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.insertBefore(last, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("]);\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.appendChild(first);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播宽度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setWidth("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.carouselWidth);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播高度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setHeight("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.carouselHeight);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取轮播宽度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getWidth("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置初始位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播长度")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setWidth("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children.length);\n}\n")])]),r("p",[s._v("添加首尾的过渡元素、设置高度宽度等。")]),r("h2",[s._v("绑定轮播事件")]),r("p",[s._v("然后是鼠标移入移出事件的绑定：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("playCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIntervalr = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".setInterval("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        _this.nextCarousel();\n    }, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.carouselInterval);\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("bindCarousel")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 鼠标移入移出事件")]),s._v("\n    addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'mouseenter'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n        clearInterval(_this.carouselIntervalr);\n    });\n    addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'mouseleave'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n        _this.playCarousel();\n    });\n}\n")])]),r("p",[s._v("移入时停止轮播播放的定时器，移出后自动开始下一张的播放。")]),r("p",[s._v("完成"),r("code",{pre:!0},[s._v("nextCarousel()")]),s._v("和"),r("code",{pre:!0},[s._v("prevCarousel()")]),s._v("函数：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("prevCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变轮播序号")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex--;\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount;\n        }\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播位置")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".moveCarousel("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isFirstCarousel(), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.showCarouselDot) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 显示当前圆点")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setDot();\n        }\n    }\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("nextCarousel")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex++;\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex > "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n        }\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".moveCarousel("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isLastCarousel(), -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.showCarouselDot) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 显示当前圆点")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setDot();\n        }\n    }\n}\n")])]),r("p",[s._v("功能是一样的，改变轮播序号，然后进行轮播的移动。在"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("中完成对过渡元素的处理：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("moveCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("status, carouselWidth")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" left = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (status) {\n        left = -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth;\n    } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n        left = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap) + carouselWidth;\n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, left);\n}\n")])]),r("p",[s._v("轮播相关属性和事件的设置就完成了。")]),r("h2",[s._v("绑定圆点事件")]),r("p",[s._v("接下来是小圆点的事件绑定：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("bindDots: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", len = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselDots.children.length; i < len; i++) {\n        ("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("i")]),s._v(") ")]),s._v("{\n            addEvent(_this.carouselDots.children[i], "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'click'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("ev")]),s._v(") ")]),s._v("{\n                "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取点击的圆点序号")]),s._v("\n                _this.dotIndex = i + "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!_this.isCarouselAnimate && _this.carouselIndex !== _this.dotIndex) {\n                "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变圆点点击状态")]),s._v("\n                _this.isDotClick = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(";\n                "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变圆点位置")]),s._v("\n                _this.moveDot();\n                }\n            });\n        })(i);\n    }\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("moveDot")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变当前轮播序号")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".dotIndex;\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重设当前圆点样式")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setDot();\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("setDot")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" i = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", len = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselDots.children.length; i < len; i++) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselDots.children[i].setAttribute("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'class'")]),s._v(", CLASS.CAROUSEL_DOT);\n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselDots.children["),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("].setAttribute("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'class'")]),s._v(", CLASS.CAROUSEL_DOT_ON);\n}\n")])]),r("p",[s._v("功能很简单，点击圆点后，跳转到对应序号的轮播图，并重设小圆点样式。")]),r("h2",[s._v("绑定箭头事件")]),r("p",[s._v("最后，还需要绑定箭头事件：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("bindArrows: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 箭头点击事件")]),s._v("\n    addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".arrowLeft, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'click'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n        _this.prevCarousel();\n    });\n    addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".arrowRight, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'click'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n        _this.nextCarousel();\n    });\n}\n")])]),r("p",[s._v("这样，一个没有动画的无缝轮播效果就完成了，见下图："),r("br"),r("img",{attrs:{src:"https://i.loli.net/2018/08/10/5b6d520d4dee5.gif",alt:"carousel-test"}})]),r("h2",[s._v("实现动画效果")]),r("p",[s._v("上一节我们分析后的思路基本是实现了，但是轮播切换时的动画效果又该怎么实现呢？")]),r("p",[s._v("既然要实现动画，那我们先要找到产生动画的源头——即让轮播发生切换的"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("函数。因此，我们需要先对它进行修改：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("moveCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("target, speed")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n    _this.isCarouselAnimate = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("animateCarousel")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ((speed > "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" && _this.getLeft(_this.carouselWrap) < target) ||\n            (speed < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" && _this.getLeft(_this.carouselWrap) > target)) {\n        _this.setLeft(_this.carouselWrap, _this.getLeft(_this.carouselWrap) + speed);\n        timer = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".setTimeout(animateCarousel, _this.carouselOptions.carouselAnimateInterval);\n        } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n        "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".clearTimeout(timer);\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重置轮播状态")]),s._v("\n        _this.resetCarousel(target, speed);\n        }\n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" timer = animateCarousel();\n}\n")])]),r("p",[s._v("改造之后的"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("函数接受两个参数，"),r("code",{pre:!0},[s._v("target")]),s._v("表示要移动到的轮播的位置，"),r("code",{pre:!0},[s._v("speed")]),s._v("即为我们前面计算出的那个偏移量的值。然后通过"),r("code",{pre:!0},[s._v("animateCarousel()")]),s._v("函数进行"),r("code",{pre:!0},[s._v("setTimeout()")]),s._v("的递归调用，模拟出一种定时器的效果，当判断未到达目标位置时继续递归，如果到达后就重置轮播状态：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 不符合位移条件，把当前left值置为目标值")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, target);\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//如当前在辅助图上，就归位到真的图上")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (target > -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth ) {\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n}\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (target < (-"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount)) {\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n}\n")])]),r("p",[s._v("重置的过程和前面的实现是一样的，不再赘述。完成新的"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("函数之后，还需要对"),r("code",{pre:!0},[s._v("prevCarousel()")]),s._v("及"),r("code",{pre:!0},[s._v("nextCarousel()")]),s._v("进行改造：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("prevCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变轮播序号")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex--;\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount;\n        }\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 设置轮播位置")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".moveCarousel("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap) + "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselAnimateSpeed);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.showCarouselDot) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 显示当前圆点")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setDot();\n        }\n    }\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("nextCarousel")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex++;\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex > "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n        }\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".moveCarousel("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap) - "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth,  -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselAnimateSpeed);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.showCarouselDot) {\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 显示当前圆点")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setDot();\n        }\n    }\n},\n")])]),r("p",[s._v("其实就替换了一下"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("调用的参数而已。完成这几个函数的改造后，动画效果初步实现了："),r("br"),r("img",{attrs:{src:"https://i.loli.net/2018/08/10/5b6d584522ade.gif",alt:"carousel-test1"}})]),r("h2",[s._v("优化动画效果")]),r("p",[s._v("在页面上进行实际测试的过程中，我们可能偶尔会发现有卡顿的情况出现，这主要是因为用"),r("code",{pre:!0},[s._v("setTimeout()")]),s._v("递归后模拟动画的时候产生的（直接用"),r("code",{pre:!0},[s._v("setInterval()")]),s._v("同样会出现这种情况），所以我们需要用"),r("code",{pre:!0},[s._v("requestAnimationFrame")]),s._v("这个HTML5的新API进行动画效率的优化，再次改造"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("函数：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("moveCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("target, speed")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n    _this.isCarouselAnimate = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("animateCarousel")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ((speed > "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" && _this.getLeft(_this.carouselWrap) < target) ||\n            (speed < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" && _this.getLeft(_this.carouselWrap) > target)) {\n            _this.setLeft(_this.carouselWrap, _this.getLeft(_this.carouselWrap) + speed);\n            timer = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".requestAnimationFrame(animateCarousel);\n        } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n            "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".cancelAnimationFrame(timer);\n            "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重置轮播状态")]),s._v("\n            _this.resetCarousel(target, speed);\n        }\n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" timer = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".requestAnimationFrame(animateCarousel);\n}\n")])]),r("p",[s._v("两种方法的调用方式是类似的，但是在实际看起来，动画却流畅了不少，最重要的，它让我们动画的效率得到了很大提升。")]),r("p",[s._v("到这里，我们的开发就结束了吗？"),r("br"),s._v(" 用上面的方式实现完动画后，当你点击圆点时，轮播的切换是跳跃式的，并没有达到我们开头gif中那种完成后的效果。要让任意圆点点击后的切换效果仍然像相邻图片一样的切换，这里还需要一种新的思路。")]),r("p",[s._v("假如我们当前在第一张图片，这时候的序号为1，而点击的圆点对应图片序号为5的话，我们可以这么处理：在序号1对应图片节点的后面插入一个序号5对应的图片节点，然后让轮播切换到这张新增的图片，切换完成后，立即改变图片位置为真正的序号5图片，最后删除新增的节点，过程如下：")]),r("blockquote",[r("p",[s._v("第一步：插入一个新节点 5 1 5 2 3 4 5 1")])]),r("blockquote",[r("p",[s._v("第二步：改变图片位置，节点顺序不变")])]),r("blockquote",[r("p",[s._v("第三步：删除新节点，还原节点顺序 5 1 2 3 4 5 1")])]),r("p",[s._v("用代码实现出来就是这样的：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("moveDot: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变轮播DOM，增加过渡效果")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".changeCarousel();\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 改变当前轮播序号")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".dotIndex;\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重设当前圆点样式")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setDot();\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("changeCarousel")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 保存当前节点位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".currentNode = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children["),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex];\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取目标节点位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" targetNode = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.children["),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".dotIndex];\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 判断点击圆点与当前的相对位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex < "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".dotIndex) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 在当前元素右边插入目标节点")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" nextNode = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".currentNode.nextElementSibling;\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.insertBefore(targetNode.cloneNode("),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v("), nextNode);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".moveCarousel("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap) - "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselAnimateSpeed);\n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex > "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".dotIndex) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 在当前元素左边插入目标节点")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.insertBefore(targetNode.cloneNode("),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v("), "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".currentNode);\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 因为向左边插入节点后，当前元素的位置被改变，导致画面有抖动现象，这里重置为新的位置")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselIndex + "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".moveCarousel("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".getLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap) + "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselAnimateSpeed);\n    }\n}\n")])]),r("p",[s._v("需要注意的是，这里要判断点击的圆点序号与当前序号的关系，也就是在当前序号的左边还是右边，如果是左边，还需要对位置进行重置。最后一步，完成新增节点的删除函数"),r("code",{pre:!0},[s._v("resetMoveDot()")]),s._v("：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("resetCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("target, speed")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 判断圆点是否点击")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isDotClick) {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重置圆点点击后的状态")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".resetMoveDot(speed);\n    } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重置箭头或者自动轮播后的状态")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".resetMoveCarousel(target);\n    }\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isDotClick = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("resetMoveDot")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("speed")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 如果是圆点点击触发动画，需要删除新增的过度节点并将轮播位置重置到实际位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setLeft("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".dotIndex * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 判断点击圆点和当前圆点的相对位置")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (speed < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.removeChild("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".currentNode.nextElementSibling);\n    } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.removeChild("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".currentNode.previousElementSibling);\n    }\n},\n")])]),r("p",[s._v("查看一下效果："),r("br"),r("img",{attrs:{src:"https://i.loli.net/2018/08/10/5b6d60f398104.gif",alt:"carousel-test2"}})]),r("p",[s._v("大功告成！！")]),r("h1",[s._v("H5轮播")]),r("p",[s._v("在Web版轮播的实现中，我们对位置的控制是直接使用元素绝对定位后的"),r("code",{pre:!0},[s._v("left")]),s._v("值实现的，这种办法虽然兼容性好，但是效率相对是比较低的。在移动端版本的实现中，我们就可以不用考虑这种兼容性的问题了，而可以尽量用更高效的方式实现动画效果。")]),r("p",[s._v("如果大家对CSS3有所了解，那想必一定知道"),r("code",{pre:!0},[s._v("transform")]),s._v("这个属性。从字面上来讲，它就是变形，改变的意思，而它的值大致包括"),r("code",{pre:!0},[s._v("旋转rotate")]),s._v("、"),r("code",{pre:!0},[s._v("扭曲skew")]),s._v("、"),r("code",{pre:!0},[s._v("缩放scale")]),s._v("和"),r("code",{pre:!0},[s._v("移动translate")]),s._v("以及"),r("code",{pre:!0},[s._v("矩阵变形matrix")]),s._v("等几种类型。我们今天需要用到的就是"),r("code",{pre:!0},[s._v("translate")]),s._v("，通过使用它以及"),r("code",{pre:!0},[s._v("transition")]),s._v("等动画属性，可以更高效简洁的实现移动端图片轮播的移动。")]),r("p",[s._v("由于基本思路与架构和Web版是差不多的，而H5版是基于Web版重写的，所以这里只说下需要改变的几个地方。")]),r("h2",[s._v("替换Left的操作方法")]),r("p",[s._v("既然是用新属性来实现，那首先就要重写"),r("code",{pre:!0},[s._v("setLeft()")]),s._v("和"),r("code",{pre:!0},[s._v("getLeft()")]),s._v("方法，这里我们直接替换为两个新方法：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("setLeft: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("elem, value")]),s._v(") ")]),s._v("{\n  elem.style.left = value + "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'px'")]),s._v(";\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("getLeft")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("elem")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("parseInt")]),s._v("(elem.style.left);\n}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("setTransform")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("elem ,value")]),s._v(") ")]),s._v("{\n  elem.style.transform =\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"translate3d("')]),s._v(" + value + "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"px, 0px, 0px)"')]),s._v(";\n  elem.style["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"-webkit-transform"')]),s._v("] =\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"translate3d("')]),s._v(" + value + "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"px, 0px, 0px)"')]),s._v(";\n  elem.style["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"-ms-transform"')]),s._v("] =\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"translate3d("')]),s._v(" + value + "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"px, 0px, 0px)"')]),s._v(";\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("getTransform")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" x =\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.style.transform ||\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.style["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"-webkit-transform"')]),s._v("] ||\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap.style["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"-ms-transform"')]),s._v("];\n  x = x.substring("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("12")]),s._v(");\n  x = x.match("),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/(\\S*)px/")]),s._v(")["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("];\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Number")]),s._v("(x);\n}\n")])]),r("p",[s._v("新版的方法功能与老版完全一直，只是实现所用到的方法不一样了。接下来我们需要一个"),r("code",{pre:!0},[s._v("transition")]),s._v("值的设置方法，通过这个动画属性，连"),r("code",{pre:!0},[s._v("requestAnimationFrame")]),s._v("的相关操作也不需要了：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("setTransition: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("elem, value")]),s._v(") ")]),s._v("{\n  elem.style.transition = value + "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'ms'")]),s._v(";\n}\n")])]),r("p",[s._v("有了这三个方法，接下来就可以重写"),r("code",{pre:!0},[s._v("moveCarousel()")]),s._v("、"),r("code",{pre:!0},[s._v("resetCarousel()")]),s._v("和"),r("code",{pre:!0},[s._v("resetMoveCarousel()")]),s._v("方法了：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("moveCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("target")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".isCarouselAnimate = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(";\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setTransition("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselOptions.carouselDuration);\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setTransform("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, target);\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".resetCarousel(target);\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("resetCarousel")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("target")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n  "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".setTimeout("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 重置箭头或者自动轮播后的状态")]),s._v("\n    _this.resetMoveCarousel(target);\n    _this.isCarouselAnimate = "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("false")]),s._v(";\n  }, _this.carouselOptions.carouselDuration);\n},\n"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("resetMoveCarousel")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("target")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setTransition("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(");\n  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 不符合位移条件，把当前left值置为目标值")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setTransform("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, target);\n  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//如当前在辅助图上，就归位到真的图上")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (target > -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth) {\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setTransform("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n  }\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (target < -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth * "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselCount) {\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".setTransform("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWrap, -"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carouselWidth);\n  }\n}\n")])]),r("p",[s._v("之所以在每次"),r("code",{pre:!0},[s._v("setTransform()")]),s._v("改变位置之前都要重新设置"),r("code",{pre:!0},[s._v("transition")]),s._v("的值，是因为"),r("code",{pre:!0},[s._v("transition")]),s._v("会使每次位置的改变都带上动画效果，而我们在代码中做的过渡操作又不希望用户直接看到，因此，重设它的值后才能和以前的实现效果保持一致。")]),r("h2",[s._v("添加touch事件")]),r("p",[s._v("在移动端上我们通常习惯用手指直接触摸屏幕来操作应用，所以Web端圆点和箭头的交互方式这时候就显得不那么合适了，取而代之的，我们可以改写成触摸的交互方式，也就是"),r("code",{pre:!0},[s._v("touch")]),s._v("事件实现的效果：")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-javascript"}},[s._v("bindCarousel: "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" _this = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(";\n  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 鼠标移入移出事件")]),s._v("\n  addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"touchstart"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!_this.isCarouselAnimate) {\n      clearInterval(_this.carouselIntervalr);\n      _this.carouselTouch.startX = _this.getTransform();\n      _this.carouselTouch.start = e.changedTouches[e.changedTouches.length - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("].clientX;\n    }\n  });\n  addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"touchmove"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!_this.isCarouselAnimate && _this.carouselTouch.start != "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("-1")]),s._v(") {\n      clearInterval(_this.carouselIntervalr);\n      _this.carouselTouch.move =\n        e.changedTouches[e.changedTouches.length - "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("].clientX - _this.carouselTouch.start;\n      _this.setTransform(_this.carouselWrap, _this.carouselTouch.move + _this.carouselTouch.startX);\n    }\n  });\n  addEvent("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".carousel, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"touchend"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (!_this.isCarouselAnimate && _this.carouselTouch.start != "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("-1")]),s._v(") {\n      clearInterval(_this.carouselIntervalr);\n      _this.setTransform(_this.carouselWrap, _this.carouselTouch.move + _this.carouselTouch.startX);\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" x = _this.getTransform();\n      x +=\n        _this.carouselTouch.move > "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("\n          ? _this.carouselWidth * _this.carouselTouch.offset\n          : _this.carouselWidth * -_this.carouselTouch.offset;\n      _this.carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Math")]),s._v(".round(x / _this.carouselWidth) * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("-1")]),s._v(";\n      _this.moveCarousel(\n        _this.carouselIndex * -_this.carouselWidth\n      );\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (_this.carouselIndex > _this.carouselCount) {\n        _this.carouselIndex = "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n      }\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (_this.carouselIndex < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(") {\n        _this.carouselIndex = _this.carouselCount;\n      }\n      _this.playCarousel();\n    }\n  });\n}\n")])]),r("p",[s._v("简单来说，我们把触摸事件分为三个过程——开始、移动、结束，然后在这三个过程中，就可以分别实现对应的逻辑与操作了：")]),r("ol",[r("li",[s._v("touchmove获取触摸的起始点")]),r("li",[s._v("touchmove计算触摸后的偏移量")]),r("li",[s._v("判断偏移的方向，改变图片位置")])]),r("p",[s._v("通过这套逻辑，我们模拟的移动设备的触摸效果就能成功实现了："),r("br"),r("img",{attrs:{src:"https://i.loli.net/2018/08/12/5b6fcc24484ba.gif",alt:"carousel-test4"}})]),r("blockquote",[r("p",[s._v("文章本身只是对项目整体思路和重点部分的讲解，一些细节点也不可能面面俱到，还请大家对照源码自行理解学习~")])]),r("p",[s._v("最后我想说的是，类似轮播这样的优秀插件其实已经有很多了，但这并不妨碍我们写一个自己的版本。因为只有自己写一遍，并在脑中走一遍自己的思维过程，然后在学习一些优秀的源码及实现时才不至于懵圈。")]),r("p",[s._v("到止为止，我们第二个轮子的开发也算顺利完成了，所有源码已同步更新到"),r("code",{pre:!0},[s._v("github")]),s._v("，如果大家发现有bug或其他问题，可以回复在项目的"),r("code",{pre:!0},[s._v("issue")]),s._v("中，咱们后会有期！（挖坑不填，逃。。")]),r("p",[s._v("To be continued...")]),r("h1",[s._v("参考内容")]),r("ul",[r("li",[r("a",{attrs:{href:"https://www.zhihu.com/question/37809744"}},[s._v("JS 跑马灯（轮播图）效果中，最后一张滚回到第一张，怎样优化“视觉倒退”？")])]),r("li",[r("a",{attrs:{href:"https://www.cnblogs.com/yewenxiang/p/6115931.html"}},[s._v("用原生的javascript 实现一个无限滚动的轮播图")])]),r("li",[r("a",{attrs:{href:"https://kongwsh.github.io/2016/09/28/carousel/"}},[s._v("原生JavaScript实现轮播图")])]),r("li",[r("a",{attrs:{href:"https://www.cnblogs.com/zhuzhenwei918/p/6416880.html"}},[s._v("原生js实现轮播图")])]),r("li",[r("a",{attrs:{href:"http://www.cnblogs.com/LIUYANZUO/p/5679753.html"}},[s._v("手把手原生js简单轮播图")])]),r("li",[r("a",{attrs:{href:"https://github.com/zwhGithub/vue-swiper"}},[s._v("vue-swiper")])])])])}],l=r("2877"),n={},p=Object(l["a"])(n,t,e,!1,null,null,null);a["default"]=p.exports}}]);